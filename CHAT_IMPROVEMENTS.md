# üì± –ù–æ–≤–∏ –§—É–Ω–∫—Ü–∏–∏ - –ß–∞—Ç –∏ –ù–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

## üîî –ù–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∑–∞ –Ω–æ–≤–∏ —Å—ä–æ–±—â–µ–Ω–∏—è

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–Ω–æ—Å—Ç
- **Badge –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏—è—Ç–∞** - –ß–µ—Ä–≤–µ–Ω –∫—Ä—ä–≥ —Å –±—Ä–æ–π –Ω–µ–ø—Ä–æ—á–µ—Ç–µ–Ω–∏ —Å—ä–æ–±—â–µ–Ω–∏—è
- **Real-time –æ–±–Ω–æ–≤—è–≤–∞–Ω–µ** - –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –≤—Å–µ–∫–∏ 5 —Å–µ–∫—É–Ω–¥–∏
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –º–∞—Ä–∫–∏—Ä–∞–Ω–µ** - –°—ä–æ–±—â–µ–Ω–∏—è—Ç–∞ —Å–µ –º–∞—Ä–∫–∏—Ä–∞—Ç –∫–∞—Ç–æ –ø—Ä–æ—á–µ—Ç–µ–Ω–∏ –ø—Ä–∏ –æ—Ç–≤–∞—Ä—è–Ω–µ –Ω–∞ —á–∞—Ç–∞
- **–í–∏–∑—É–∞–ª–µ–Ω –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä** - –ü–æ–∫–∞–∑–≤–∞ —Å–µ —Å–∞–º–æ –∫–æ–≥–∞—Ç–æ –∏–º–∞ –Ω–µ–ø—Ä–æ—á–µ—Ç–µ–Ω–∏ —Å—ä–æ–±—â–µ–Ω–∏—è

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –¥–µ—Ç–∞–π–ª–∏
- –ù–æ–≤ API endpoint: `GET /api/chat/unread-count`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –º–∞—Ä–∫–∏—Ä–∞–Ω–µ –ø—Ä–∏ —á–µ—Ç–µ–Ω–µ: `UPDATE messages SET is_read = true`
- Polling interval: 5000ms (5 —Å–µ–∫—É–Ω–¥–∏)

---

## üí¨ –ü–æ–¥–æ–±—Ä–µ–Ω–∏—è –≤ —á–∞—Ç–∞

### 1. –ï–º–æ–¥–∂–∏ –ø–∏–∫–µ—Ä
- **–ë—É—Ç–æ–Ω –∑–∞ –µ–º–æ–¥–∂–∏—Ç–∞** - üòä –±—É—Ç–æ–Ω –æ—Ç–≤–∞—Ä—è –ø–∞–Ω–µ–ª —Å –µ–º–æ–¥–∂–∏—Ç–∞
- **10 –ø–æ–ø—É–ª—è—Ä–Ω–∏ –µ–º–æ–¥–∂–∏—Ç–∞**: üòä üò¢ üò∞ üò° ‚ù§Ô∏è üëç üôè üí™ üåü ‚ú®
- **–õ–µ—Å–Ω–æ –¥–æ–±–∞–≤—è–Ω–µ** - –ö–ª–∏–∫–≤–∞–Ω–µ –¥–æ–±–∞–≤—è –µ–º–æ–¥–∂–∏ –≤ —Ç–µ–∫—Å—Ç–∞
- **Auto-close** - –ü–∞–Ω–µ–ª—ä—Ç —Å–µ –∑–∞—Ç–≤–∞—Ä—è —Å–ª–µ–¥ –∏–∑–±–æ—Ä

### 2. –í–∞–∂–Ω–∏ —Å—ä–æ–±—â–µ–Ω–∏—è
- **–ú–∞—Ä–∫–∏—Ä–∞–Ω–µ —Å—ä—Å –∑–≤–µ–∑–¥–∞** ‚≠ê - –í–∏–∑—É–∞–ª–Ω–æ –æ—Ç–ª–∏—á–∞–≤–∞–Ω–µ –Ω–∞ –≤–∞–∂–Ω–∏ —Å—ä–æ–±—â–µ–Ω–∏—è
- **–ó–ª–∞—Ç–Ω–∞ —Ä–∞–º–∫–∞** - –í–∞–∂–Ω–∏—Ç–µ —Å—ä–æ–±—â–µ–Ω–∏—è –∏–º–∞—Ç –∑–ª–∞—Ç–∏—Å—Ç–∞ —Å—è–Ω–∫–∞
- **API –ø–æ–¥–¥—Ä—ä–∂–∫–∞** - Backend —Å—ä—Ö—Ä–∞–Ω—è–≤–∞ `is_important` —Ñ–ª–∞–≥
- **Toggle —Ñ—É–Ω–∫—Ü–∏—è** - –ú–æ–∂–µ –¥–∞ —Å–µ –≤–∫–ª—é—á–≤–∞/–∏–∑–∫–ª—é—á–≤–∞

### 3. –ü–æ–¥–æ–±—Ä–µ–Ω UI/UX
- **–ú–æ–¥–µ—Ä–µ–Ω –¥–∏–∑–∞–π–Ω** - –ó–∞–∫—Ä—ä–≥–ª–µ–Ω–∏ –±–∞–ª–æ–Ω—á–µ—Ç–∞ –∑–∞ —Å—ä–æ–±—â–µ–Ω–∏—è
- **–¶–≤–µ—Ç–æ–≤–∞ —Å—Ö–µ–º–∞**:
  - –ò–∑–ø—Ä–∞—Ç–µ–Ω–∏: –ó–µ–ª–µ–Ω —Ñ–æ–Ω (#22c55e)
  - –ü–æ–ª—É—á–µ–Ω–∏: –ë—è–ª —Ñ–æ–Ω
  - –í–∞–∂–Ω–∏: –ó–ª–∞—Ç–∏—Å—Ç–∞ —Ä–∞–º–∫–∞ (#fbbf24)
- **Responsive layout** - –ê–¥–∞–ø—Ç–∏–≤–µ–Ω –¥–∏–∑–∞–π–Ω –∑–∞ —Ä–∞–∑–ª–∏—á–Ω–∏ –µ–∫—Ä–∞–Ω–∏
- **Smooth animations** - –ü–ª–∞–≤–Ω–∏ –ø—Ä–µ—Ö–æ–¥–∏ –∏ –∞–Ω–∏–º–∞—Ü–∏–∏

### 4. Typing indicator
- **"–ø–∏—à–µ..." –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä** - –ü–æ–∫–∞–∑–≤–∞ –∫–æ–≥–∞ –¥—Ä—É–≥–∏—è—Ç –ø–∏—à–µ
- **Real-time** - –û–±–Ω–æ–≤—è–≤–∞ —Å–µ –Ω–∞ –≤—Å–µ–∫–∏ 2 —Å–µ–∫—É–Ω–¥–∏
- **Timeout** - –ò–∑—á–µ–∑–≤–∞ —Å–ª–µ–¥ 3 —Å–µ–∫—É–Ω–¥–∏ –±–µ–∑ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç
- **–í–∏–∑—É–∞–ª–µ–Ω feedback** - –ë–∞–ª–æ–Ω—á–µ —Å "üí¨ –ø–∏—à–µ..."

### 5. Auto-scroll
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Å–∫—Ä–æ–ª–≤–∞–Ω–µ** - –í–∏–Ω–∞–≥–∏ –ø–æ–∫–∞–∑–≤–∞ –ø–æ—Å–ª–µ–¥–Ω–æ—Ç–æ —Å—ä–æ–±—â–µ–Ω–∏–µ
- **Smooth behavior** - –ü–ª–∞–≤–Ω–æ —Å–∫—Ä–æ–ª–≤–∞–Ω–µ
- **–ü—Ä–∏ –Ω–æ–≤–∏ —Å—ä–æ–±—â–µ–Ω–∏—è** - –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Å–∫—Ä–æ–ª–≤–∞ –ø—Ä–∏ –ø–æ–ª—É—á–∞–≤–∞–Ω–µ

---

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω–∏ –ø—Ä–æ–º–µ–Ω–∏

### Messages —Ç–∞–±–ª–∏—Ü–∞
```sql
ALTER TABLE messages ADD COLUMN is_read BOOLEAN DEFAULT false;
ALTER TABLE messages ADD COLUMN is_important BOOLEAN DEFAULT false;
```

### –ù–æ–≤–∏ –∫–æ–ª–æ–Ω–∏:
- `is_read` - –î–∞–ª–∏ —Å—ä–æ–±—â–µ–Ω–∏–µ—Ç–æ –µ –ø—Ä–æ—á–µ—Ç–µ–Ω–æ
- `is_important` - –î–∞–ª–∏ —Å—ä–æ–±—â–µ–Ω–∏–µ—Ç–æ –µ –º–∞—Ä–∫–∏—Ä–∞–Ω–æ –∫–∞—Ç–æ –≤–∞–∂–Ω–æ

---

## üîå –ù–æ–≤–∏ API Endpoints

### 1. –ë—Ä–æ–π –Ω–µ–ø—Ä–æ—á–µ—Ç–µ–Ω–∏ —Å—ä–æ–±—â–µ–Ω–∏—è
```
GET /api/chat/unread-count
Authorization: Bearer <token>

Response:
{
  "count": 5
}
```

### 2. –ú–∞—Ä–∫–∏—Ä–∞–Ω–µ –∫–∞—Ç–æ –≤–∞–∂–Ω–æ
```
POST /api/chat/toggle-important/:messageId
Authorization: Bearer <token>

Response:
{
  "success": true
}
```

### 3. –ò–∑–ø—Ä–∞—â–∞–Ω–µ –Ω–∞ —Å—ä–æ–±—â–µ–Ω–∏–µ (–æ–±–Ω–æ–≤–µ–Ω)
```
POST /api/chat/send
Authorization: Bearer <token>
Body:
{
  "recipientId": 123,
  "text": "–ó–¥—Ä–∞–≤–µ–π!",
  "isImportant": false
}
```

### 4. –ü–æ–ª—É—á–∞–≤–∞–Ω–µ –Ω–∞ —Å—ä–æ–±—â–µ–Ω–∏—è (–æ–±–Ω–æ–≤–µ–Ω)
```
GET /api/chat/messages/:recipientId
Authorization: Bearer <token>

Response:
{
  "messages": [
    {
      "id": 1,
      "text": "–ó–¥—Ä–∞–≤–µ–π",
      "sender_id": 123,
      "time": "14:30",
      "is_read": true,
      "is_important": false
    }
  ],
  "isTyping": false
}
```

---

## üìÇ –ü—Ä–æ–º–µ–Ω–µ–Ω–∏ —Ñ–∞–π–ª–æ–≤–µ

### Backend
- `backend/server-postgres.js`
  - –î–æ–±–∞–≤–µ–Ω–∏ –∫–æ–ª–æ–Ω–∏ –≤ messages —Ç–∞–±–ª–∏—Ü–∞
  - –ù–æ–≤–∏ API endpoints
  - Auto-marking –∫–∞—Ç–æ –ø—Ä–æ—á–µ—Ç–µ–Ω–æ

### Frontend
- `frontend/src/pages/PatientChat.jsx`
  - –ï–º–æ–¥–∂–∏ –ø–∏–∫–µ—Ä
  - Unread count badge
  - –í–∞–∂–Ω–∏ —Å—ä–æ–±—â–µ–Ω–∏—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
  
- `frontend/src/pages/TherapistChat.jsx`
  - –ï–º–æ–¥–∂–∏ –ø–∏–∫–µ—Ä
  - –í–∞–∂–Ω–∏ —Å—ä–æ–±—â–µ–Ω–∏—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
  - –ü–æ–¥–æ–±—Ä–µ–Ω UI

- `frontend/src/components/Navigation.jsx`
  - Badge —Å –Ω–µ–ø—Ä–æ—á–µ—Ç–µ–Ω–∏ —Å—ä–æ–±—â–µ–Ω–∏—è
  - Auto-refresh –Ω–∞ –≤—Å–µ–∫–∏ 5 —Å–µ–∫—É–Ω–¥–∏
  - –õ–∏–Ω–∫ –∫—ä–º —á–∞—Ç–∞ –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏—è—Ç–∞

---

## üöÄ –ö–∞–∫ –¥–∞ —Ç–µ—Å—Ç–≤–∞—Ç–µ

1. **Rebuild Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏—Ç–µ**:
   ```bash
   docker-compose down
   docker-compose build --no-cache frontend
   docker-compose up -d
   ```

2. **–¢–µ—Å—Ç–≤–∞–π—Ç–µ –Ω–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏—Ç–µ**:
   - –í–ª–µ–∑—Ç–µ –∫–∞—Ç–æ –ø–∞—Ü–∏–µ–Ω—Ç
   - –¢–µ—Ä–∞–ø–µ–≤—Ç—ä—Ç –∏–∑–ø—Ä–∞—â–∞ —Å—ä–æ–±—â–µ–Ω–∏–µ
   - –ü—Ä–æ–≤–µ—Ä–µ—Ç–µ —á–µ—Ä–≤–µ–Ω–∏—è badge –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏—è—Ç–∞
   - –û—Ç–≤–æ—Ä–µ—Ç–µ —á–∞—Ç–∞ - badge-—ä—Ç –∏–∑—á–µ–∑–≤–∞

3. **–¢–µ—Å—Ç–≤–∞–π—Ç–µ –µ–º–æ–¥–∂–∏—Ç–∞—Ç–∞**:
   - –û—Ç–≤–æ—Ä–µ—Ç–µ —á–∞—Ç–∞
   - –ö–ª–∏–∫–Ω–µ—Ç–µ –Ω–∞ üòä –±—É—Ç–æ–Ω–∞
   - –ò–∑–±–µ—Ä–µ—Ç–µ –µ–º–æ–¥–∂–∏
   - –ò–∑–ø—Ä–∞—Ç–µ—Ç–µ —Å—ä–æ–±—â–µ–Ω–∏–µ

4. **–¢–µ—Å—Ç–≤–∞–π—Ç–µ typing indicator**:
   - –û—Ç–≤–æ—Ä–µ—Ç–µ —á–∞—Ç–∞ –æ—Ç –¥–≤–µ—Ç–µ —Å—Ç—Ä–∞–Ω–∏
   - –ó–∞–ø–æ—á–Ω–µ—Ç–µ –¥–∞ –ø–∏—à–µ—Ç–µ
   - –î—Ä—É–≥–∞—Ç–∞ —Å—Ç—Ä–∞–Ω–∞ –≤–∏–∂–¥–∞ "–ø–∏—à–µ..."

---

## ‚úÖ –ì–æ—Ç–æ–≤–æ –∑–∞ –ø—Ä–æ–¥—É–∫—Ü–∏—è

–í—Å–∏—á–∫–∏ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–∞ —Ç–µ—Å—Ç–≤–∞–Ω–∏ –∏ –≥–æ—Ç–æ–≤–∏ –∑–∞ –∏–∑–ø–æ–ª–∑–≤–∞–Ω–µ. –ù–µ –∑–∞–±—Ä–∞–≤—è–π—Ç–µ –¥–∞ –Ω–∞–ø—Ä–∞–≤–∏—Ç–µ Docker rebuild –ø—Ä–µ–¥–∏ —Ç–µ—Å—Ç–≤–∞–Ω–µ!

**–í–∞–∂–Ω–æ**: –ü–æ—Ä–∞–¥–∏ Docker –∫–µ—à–∞, –ø—Ä–æ–º–µ–Ω–∏—Ç–µ –Ω—è–º–∞ –¥–∞ —Å–µ –≤–∏–¥—è—Ç –±–µ–∑ rebuild —Å `--no-cache` —Ñ–ª–∞–≥!
